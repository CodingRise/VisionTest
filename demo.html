<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <style>
        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        .popup-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <label id="timer-label" style="text-align: center; font-weight: bold;">00:00</label>
    <br>
    <br>
    <h1 style="text-align: center;">Level <span id="level">1</span></h1>
    <div style="border: 1px black double; height: 100px; padding: 10px; text-align: center; border-radius: 10px; margin: 10px; display: flex; justify-content: center; align-items: center;">
        <label id="random-text" style="color: black; font-size: 40px;">number</label>
    </div>
    <br>
    <br>
    <input type="text" id="user-input" style="border-radius: 10px; height: 30px; width: 300px; text-align: center; display: block; margin: 0 auto; font-size: 20px;" placeholder="Enter the text shown above" />
    <br>
    <br>
    <br>
    <br>
    <div style="border: 5px double black; padding: 10px; border-radius: 10px; text-align: center; ">
        <button style="border-radius: 10px; font-size: 25px;" onclick="handleCannotSee()">I can't see</button>
        <button id="nextButton" style="border-radius: 10px; font-size: 25px;" onclick="handleClick()">Go to next</button>
        <button id="finishButton" style="border-radius: 10px; font-size: 25px; display: none;" onclick="handleFinish()">Finish</button>
    </div>

    <!-- Popup div -->
    <div id="popup" class="popup" style="display: none;">
        <div class="popup-content">
            <h2>Eye Test Report</h2>
            <p>Time taken to complete the test: <span id="time-taken"></span> seconds</p>
            <p id="performance"></p>
            <p id="need-glasses"></p>
            <br>
            <br>
            <br>
            <p>Report generated by VisionTest</p>
            <hr>
            <a href="index.html"><button style="border-radius: 10px; font-size: 25px;">Go to home</button></a>
        </div>
    </div>

    <div id="wrong-answer-popup" class="popup" style="display: none;">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup('wrong-answer-popup')">X</span>
            <p>Wrong answer! Please try again.</p>
        </div>
    </div>

    <div id="please-enter-popup" class="popup" style="display: none;">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup('please-enter-popup')">X</span>
            <p>Please enter something.</p>
        </div>
    </div>

    <script>
        var level = 1; // Example level, you should track the user's actual level
        var startTime;
        var interval;

        function handleClick() {
            var randomTextLabel = document.getElementById('random-text');
            var generatedText = randomTextLabel.textContent;

            var userInput = document.getElementById('user-input').value;
            if (userInput.toLowerCase() === generatedText.toLowerCase()) {
                var currentNumber = parseInt(document.getElementById('level').textContent) || 0;
                currentNumber++;
                document.getElementById('level').textContent = currentNumber;

                var currentFontSize = parseFloat(window.getComputedStyle(randomTextLabel).fontSize);
                var newFontSize = currentFontSize - 1.166666666666667; // Decrease font size
                randomTextLabel.style.fontSize = newFontSize + "px";

                randomTextLabel.textContent = generateRandomText();
            } else {
                document.getElementById('wrong-answer-popup').style.display = 'block';
            }
        }

        function handleCannotSee() {
            var performance = "";
            var needGlasses = "";

            if (level <= 5) {
                performance = "Performance: Worst";
                needGlasses = "Need for glasses: Recommended";
            } else if (level <= 10) {
                performance = "Performance: Average";
                needGlasses = "Need for glasses: Recommended";
            } else {
                performance = "Performance: Good";
                needGlasses = "Need for glasses: Not required";
            }

            document.getElementById('time-taken').textContent = "N/A";
            document.getElementById('performance').textContent = performance;
            document.getElementById('need-glasses').textContent = needGlasses;

            // Show the popup
            document.getElementById('popup').style.display = 'block';
        }

        function handleFinish() {
            clearInterval(interval);
            var performance = "Performance: Excellent";
            var needGlasses = "Need for glasses: No need for wearing glasses";

            var currentTime = Date.now();
            var timeDifference = (currentTime - startTime) / 1000;

            document.getElementById('time-taken').textContent = timeDifference.toFixed(2);
            document.getElementById('performance').textContent = performance;
            document.getElementById('need-glasses').textContent = needGlasses;

            // Show the popup
            document.getElementById('popup').style.display = 'block';
        }

        function closePopup(popupId) {
            document.getElementById(popupId).style.display = 'none';
        }

        function startCountup() {
            startTime = Date.now();
            interval = setInterval(function () {
                var currentTime = Date.now();
                var timeDifference = (currentTime - startTime) / 1000;
                document.getElementById('timer-label').textContent = formatTime(timeDifference);
            }, 1000);
        }

        function formatTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var remainingSeconds = Math.floor(seconds % 60);
            return (minutes < 10 ? "0" + minutes : minutes) + ":" + (remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds);
        }

        function generateRandomText() {
            var textArray = ["Lorem", "Ipsum", "Dolor", "Sit", "Amet", "Consectetur", "Adipiscing", "Elit", "Emo", "Mouse", "Food", "Laptop", "Desktop", "HyperActive", "Dale", "Keys123", "MeowCat"];
            var availableTexts = textArray.filter(text => !usedTexts.includes(text)); // Filter out used texts
            if (availableTexts.length === 0) {
                // If all texts have been used, reset the array
                usedTexts = [];
                availableTexts = textArray;
            }
            var randomIndex = Math.floor(Math.random() * availableTexts.length);
            var randomText = availableTexts[randomIndex];
            usedTexts.push(randomText); // Add the selected text to the used texts array
            return randomText;
        }

        var usedTexts = [];
        startCountup();
        var randomTextLabel = document.getElementById('random-text');
        randomTextLabel.textContent = generateRandomText();
    </script>
</body>
</html>
