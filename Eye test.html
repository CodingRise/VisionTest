<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <style>
        * {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .timer-container {
            text-align: center;
        }

        body {
            background-color: grey;
        }

        .popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: none; /* Hide popup by default */
}

.popup-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fff;
    padding: 20px;
    border: 2px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    text-align: center;
    max-width: 80%;
}


        /* Close button styles */
        .close-button {
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="timer-container">
        <label id="timer-label" style="font-weight: bold;">00:00</label>
    </div>
    <h1 style="text-align: center;">Level <span id="level-number">1</span></h1>
    <div style="border: 1px black double; height: 100px; padding: 10px; text-align: center; border-radius: 10px; margin: 10px; display: flex; justify-content: center; align-items: center;">
        <span id="random-text" style="color: black; font-size: 40px;">number</span>
    </div>
    <br>
    <br>
    <br>
    <input type="text" id="user-input" style="border-radius: 10px; height: 30px; width: 300px; text-align: center; display: block; margin: 0 auto; font-size: 20px;"
        placeholder="Enter the text shown above" />
    <br><br>
    <br>
    <br>
        <div style="border: 5px double black; padding: 10px; border-radius: 10px; text-align: center;">
        <a href="index.html"><button style="border-radius: 10px; font-size: 25px;">Exit Test</button></a>
        <button id="nextButton" style="border-radius: 10px; font-size: 25px;" onclick="handleClick()">Go to Next</button>
        <button id="finishButton" style="border-radius: 10px; font-size: 25px; display: none;" onclick="handleFinish()">Finish</button>
    </div>

    <!-- Popup div -->
    <div id="popup" class="popup">
        <div class="popup-content" id="popup-content">
            <!-- Content of the popup -->
            <h2>Eye Test Report</h2>
            <p>Time taken to complete the test: <span id="time-taken"></span> seconds</p>
            <p>Performance: Excellent</p>
            <p>Need for glasses: No need for wearing glasses</p>
            <br>
            <br>
            <br>
            <p>Report generated by VisionTest</p>
            <hr>
            <a href="index.html"><button style="border-radius: 10px; font-size: 25px;">Go to home</button></a>
        </div>
    </div>
    

    <!-- Wrong Answer Popup -->
    <div id="wrong-answer-popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">X</span> <!-- Close button -->
            <h2>Wrong Answer!</h2>
            <p>Please try again.</p>
        </div>
    </div>

    <!-- Please enter something Popup -->
    <div id="please-enter-popup" class="popup">
        <div class="popup-content">
            <span class="close-button" onclick="closePopup()">X</span> <!-- Close button -->
            <h2>Please enter something</h2>
            <p>You haven't entered anything. Please enter something in the text box.</p>
        </div>
    </div>

    <script>
        var usedTexts = []; // Array to store used texts
        var startTime;
        var interval;

        // Function to generate random text
        function generateRandomText() {
            var textArray = ["Lorem", "Ipsum", "Dolor", "Sit", "Amet", "Consectetur", "Adipiscing", "Elit", "Emo", "Mouse", "Food", "Laptop", "Desktop", "HyperActive", "Dale", "Keys123", "MeowCat"];
            var availableTexts = textArray.filter(text => !usedTexts.includes(text)); // Filter out used texts
            if (availableTexts.length === 0) {
                // If all texts have been used, reset the array
                usedTexts = [];
                availableTexts = textArray;
            }
            var randomIndex = Math.floor(Math.random() * availableTexts.length);
            var randomText = availableTexts[randomIndex];
            usedTexts.push(randomText); // Add the selected text to the used texts array
            return randomText;
        }

        // Function to handle button click
        function handleClick() {
            var userInput = document.getElementById('user-input').value;

            // Check if the user input is empty
            if (userInput.trim() === '') {
                // If the user input is empty, display the "Please enter something" popup
                document.getElementById('please-enter-popup').style.display = 'block';
                return; // Exit the function
            }

            var randomTextLabel = document.getElementById('random-text');
            var generatedText = randomTextLabel.textContent; // Get the current text

            // Check if the user input matches the generated text
            if (userInput.toLowerCase() === generatedText.toLowerCase()) {
                // If the answer is correct, decrease the font size and increment the number of clicks
                var currentNumber = parseInt(document.getElementById('level-number').textContent) || 0; // Default to 0 if not set
                currentNumber++;
                document.getElementById('level-number').textContent = currentNumber;

                var currentFontSize = parseFloat(window.getComputedStyle(randomTextLabel).fontSize);
                var newFontSize = currentFontSize - 2; // Decrease font size
                randomTextLabel.style.fontSize = newFontSize + "px"; // Apply new font size

                // Generate new random text
                randomTextLabel.textContent = generateRandomText();

                // Check if the level is 15
                if (currentNumber === 15) {
                    // Disable the "Go to Next" button and show the "Finish" button
                    document.getElementById('nextButton').disabled = true;
                    document.getElementById('finishButton').style.display = 'inline';
                }
            } else {
                // If the answer is wrong, display the wrong answer popup
                document.getElementById('wrong-answer-popup').style.display = 'block';
            }
        }

        // Function to handle "I can't see" button click
        function handleCannotSee() {
            // Do whatever action you want when "I can't see" button is clicked
            alert("I can't see button clicked!");
        }

        // Function to close the popup
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('wrong-answer-popup').style.display = 'none';
            document.getElementById('please-enter-popup').style.display = 'none';
        }

        // Function to start the countup
        function startCountup() {
            startTime = Date.now();
            interval = setInterval(function () {
                var currentTime = Date.now();
                var timeDifference = (currentTime - startTime) / 1000; // Time difference in seconds
                document.getElementById('timer-label').textContent = formatTime(timeDifference);
            }, 1000);
        }

        // Format time as mm:ss
        function formatTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var remainingSeconds = Math.floor(seconds % 60);
            return (minutes < 10 ? "0" + minutes : minutes) + ":" + (remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds);
        }

        // When the page loads
        window.onload = function () {
            startCountup();
            document.getElementById('random-text').textContent = generateRandomText();
        };

        // Function to handle "Finish" button click
        function handleFinish() {
            // Stop the timer
            clearInterval(interval);

            // Calculate time taken to complete the test
            var currentTime = Date.now();
            var timeDifference = (currentTime - startTime) / 1000; // Time difference in seconds

            // Show the popup with the eye test report
            document.getElementById('popup').style.display = 'block';
            document.getElementById('time-taken').textContent = timeDifference.toFixed(2); // Display time taken in seconds
        }
        function downloadImage() {
    // Select the popup content to be converted to an image
    var popupContent = document.getElementById('popup-content');

    // Use html2canvas to convert the popup content to an image
    html2canvas(popupContent).then(function(canvas) {
        // Create a temporary link element
        var link = document.createElement('a');
        link.download = 'eye_test_report.png'; // Set the download attribute
        link.href = canvas.toDataURL('image/png'); // Set the href attribute to the image data URL
        // Simulate a click on the link to trigger the download
        link.click();
    });
}

    </script>
</body>

</html>
